{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar _a;\nimport { Component } from '@angular/core';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { GrupoService } from '../services/grupo.service'; // Asegúrate de que el nombre del archivo coincida\nexport let GroupFormComponent = class GroupFormComponent {\n  constructor(fb, grupoService) {\n    this.fb = fb;\n    this.grupoService = grupoService;\n    // Variables de estado para el listado y edición\n    this.groupsList = [];\n    this.isEditing = false;\n    this.currentGroupId = null;\n    // Definición del formulario reactivo\n    this.form = this.fb.group({\n      name: ['', Validators.required],\n      members: this.fb.array([])\n    });\n  }\n  ngOnInit() {\n    this.addMember(); // Inicia con un miembro vacío\n    this.loadGroups(); // Carga la lista inicial desde la BD\n  }\n  // Getter para facilitar el acceso al FormArray en el HTML\n  get members() {\n    return this.form.get('members');\n  }\n  // Método para cargar todos los grupos del Backend\n  loadGroups() {\n    this.grupoService.getAll().subscribe({\n      next: data => {\n        this.groupsList = data;\n      },\n      error: err => console.error('Error al cargar grupos:', err)\n    });\n  }\n  // Añadir un nuevo grupo de campos de miembro al formulario\n  addMember() {\n    this.members.push(this.fb.group({\n      name: ['', Validators.required],\n      description: [''],\n      city: [''],\n      age: ['']\n    }));\n  }\n  // Eliminar un miembro del formulario\n  removeMember(index) {\n    if (this.members.length > 1) {\n      this.members.removeAt(index);\n    }\n  }\n  // Guardar o Actualizar\n  submit() {\n    if (this.form.invalid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n    const raw = this.form.value;\n    // Construimos el objeto exacto para Spring Boot\n    const payload = {\n      idGrupo: this.currentGroupId,\n      nombre: raw.name,\n      personas: (raw.members || []).map(m => ({\n        // Si estuviéramos editando, aquí faltaría el idPersona, \n        // pero Hibernate suele manejar bien el reemplazo en cascada\n        nombre: m.name,\n        descripcion: m.description || '',\n        ciudad: m.city || '',\n        edad: m.age ? Number(m.age) : 0\n      }))\n    };\n    this.grupoService.saveGroup(payload).subscribe({\n      next: () => {\n        alert(this.isEditing ? '¡Grupo actualizado con éxito!' : '¡Grupo guardado en la base de datos!');\n        this.resetForm();\n        this.loadGroups();\n      },\n      error: err => {\n        alert('Error en la operación: ' + err.message);\n      }\n    });\n  }\n  // Cargar datos de un grupo existente en el formulario\n  editGroup(group) {\n    this.isEditing = true;\n    this.currentGroupId = group.idGrupo;\n    // Seteamos el nombre del grupo\n    this.form.patchValue({\n      name: group.nombre\n    });\n    // Limpiamos los miembros actuales y cargamos los del grupo seleccionado\n    this.members.clear();\n    if (group.personas && group.personas.length > 0) {\n      group.personas.forEach(p => {\n        this.members.push(this.fb.group({\n          name: [p.nombre, Validators.required],\n          description: [p.descripcion],\n          city: [p.ciudad],\n          age: [p.edad]\n        }));\n      });\n    } else {\n      this.addMember();\n    }\n    // Scroll hacia arriba para que el usuario vea el formulario relleno\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  }\n  // Eliminar grupo\n  deleteGroup(id) {\n    if (confirm('¿Estás seguro de que deseas eliminar este grupo y todos sus miembros?')) {\n      this.grupoService.delete(id).subscribe({\n        next: () => {\n          alert('Grupo eliminado.');\n          this.loadGroups();\n          if (this.currentGroupId === id) this.resetForm();\n        },\n        error: err => alert('Error al eliminar: ' + err.message)\n      });\n    }\n  }\n  // Limpiar el formulario y volver al estado inicial\n  resetForm() {\n    this.form.reset();\n    this.members.clear();\n    this.addMember();\n    this.isEditing = false;\n    this.currentGroupId = null;\n  }\n};\nGroupFormComponent = __decorate([Component({\n  selector: 'app-group-form',\n  templateUrl: './group-form.component.html',\n  styleUrls: ['./group-form.component.css'] // Si creaste el archivo CSS\n}), __metadata(\"design:paramtypes\", [FormBuilder, typeof (_a = typeof GrupoService !== \"undefined\" && GrupoService) === \"function\" ? _a : Object])], GroupFormComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}