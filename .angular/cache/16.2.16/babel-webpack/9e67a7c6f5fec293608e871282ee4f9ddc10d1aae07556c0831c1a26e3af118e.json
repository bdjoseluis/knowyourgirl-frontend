{"ast":null,"code":"import { FormBuilder, FormArray, Validators } from '@angular/forms';\nimport { GrupoService } from '../services/email.service'; // Renombrado\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../services/email.service\";\nimport * as i3 from \"@angular/common\";\nfunction GroupFormComponent_div_10_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function GroupFormComponent_div_10_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const i_r3 = i0.ɵɵnextContext().index;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.removeMember(i_r3));\n    });\n    i0.ɵɵtext(1, \"\\u00D7\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction GroupFormComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"div\", 15)(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, GroupFormComponent_div_10_button_4_Template, 2, 0, \"button\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"input\", 17)(6, \"input\", 18);\n    i0.ɵɵelementStart(7, \"div\", 19);\n    i0.ɵɵelement(8, \"input\", 20)(9, \"input\", 21);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r3 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroupName\", i_r3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Miembro \", i_r3 + 1, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.members.length > 1);\n  }\n}\nfunction GroupFormComponent_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 23)(1, \"div\", 24)(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 25)(7, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function GroupFormComponent_div_21_Template_button_click_7_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const g_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.editGroup(g_r8));\n    });\n    i0.ɵɵtext(8, \"Editar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 27);\n    i0.ɵɵlistener(\"click\", function GroupFormComponent_div_21_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const g_r8 = restoredCtx.$implicit;\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.deleteGroup(g_r8.idGrupo));\n    });\n    i0.ɵɵtext(10, \"Eliminar\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const g_r8 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(g_r8.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", g_r8.personas.length, \" miembros\");\n  }\n}\nexport let GroupFormComponent = /*#__PURE__*/(() => {\n  class GroupFormComponent {\n    constructor(fb, grupoService) {\n      this.fb = fb;\n      this.grupoService = grupoService;\n      // Definimos el formulario con los nombres internos que prefieras\n      this.form = this.fb.group({\n        name: ['', Validators.required],\n        members: this.fb.array([])\n      });\n    }\n    ngOnInit() {\n      this.addMember();\n    }\n    get members() {\n      return this.form.get('members');\n    }\n    addMember() {\n      this.members.push(this.fb.group({\n        name: ['', Validators.required],\n        description: [''],\n        city: [''],\n        age: ['']\n      }));\n    }\n    removeMember(index) {\n      if (this.members.length > 1) this.members.removeAt(index);\n    }\n    submit() {\n      if (this.form.invalid) {\n        this.form.markAllAsTouched();\n        return;\n      }\n      const raw = this.form.value;\n      /**\n       * IMPORTANTE: Aquí mapeamos los datos para que coincidan\n       * exactamente con tus entidades de Spring Boot (Grupo y Persona)\n       */\n      const payload = {\n        nombre: raw.name,\n        personas: (raw.members || []).map(m => ({\n          nombre: m.name,\n          descripcion: m.description || '',\n          ciudad: m.city || '',\n          edad: m.age ? Number(m.age) : 0 // En Java: 'edad'\n        }))\n      };\n      // Llamamos al nuevo servicio que apunta al puerto 8087\n      this.grupoService.saveGroup(payload).subscribe({\n        next: response => {\n          console.log('Respuesta del servidor:', response);\n          alert('¡Grupo y miembros guardados con éxito en la base de datos!');\n          this.resetForm();\n        },\n        error: err => {\n          console.error(err);\n          alert('Error al conectar con Spring Boot: ' + (err.error?.message || err.message));\n        }\n      });\n    }\n    resetForm() {\n      this.form.reset();\n      this.members.clear();\n      this.addMember();\n    }\n    static {\n      this.ɵfac = function GroupFormComponent_Factory(t) {\n        return new (t || GroupFormComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.GrupoService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: GroupFormComponent,\n        selectors: [[\"app-group-form\"]],\n        decls: 22,\n        vars: 6,\n        consts: [[1, \"main-container\"], [1, \"card\", \"form-card\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\"], [\"formControlName\", \"name\", \"placeholder\", \"Ej: Las Viajeras\"], [\"formArrayName\", \"members\", 1, \"members-grid\"], [\"class\", \"member-card\", 3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [1, \"actions\"], [\"type\", \"button\", 1, \"btn-secondary\", 3, \"click\"], [\"type\", \"submit\", 1, \"btn-primary\", 3, \"disabled\"], [1, \"separator\"], [1, \"list-container\"], [1, \"groups-grid\"], [\"class\", \"group-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"member-card\", 3, \"formGroupName\"], [1, \"member-header\"], [\"type\", \"button\", \"class\", \"btn-delete\", 3, \"click\", 4, \"ngIf\"], [\"formControlName\", \"name\", \"placeholder\", \"Nombre\"], [\"formControlName\", \"description\", \"placeholder\", \"Descripci\\u00F3n\"], [1, \"row\"], [\"formControlName\", \"city\", \"placeholder\", \"Ciudad\"], [\"formControlName\", \"age\", \"type\", \"number\", \"placeholder\", \"Edad\"], [\"type\", \"button\", 1, \"btn-delete\", 3, \"click\"], [1, \"group-item\"], [1, \"group-info\"], [1, \"group-btns\"], [1, \"btn-edit\", 3, \"click\"], [1, \"btn-delete-list\", 3, \"click\"]],\n        template: function GroupFormComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\");\n            i0.ɵɵtext(3);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"form\", 2);\n            i0.ɵɵlistener(\"ngSubmit\", function GroupFormComponent_Template_form_ngSubmit_4_listener() {\n              return ctx.submit();\n            });\n            i0.ɵɵelementStart(5, \"div\", 3)(6, \"label\");\n            i0.ɵɵtext(7, \"Nombre del Grupo\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(8, \"input\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"div\", 5);\n            i0.ɵɵtemplate(10, GroupFormComponent_div_10_Template, 10, 3, \"div\", 6);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"div\", 7)(12, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function GroupFormComponent_Template_button_click_12_listener() {\n              return ctx.addMember();\n            });\n            i0.ɵɵtext(13, \"+ A\\u00F1adir Miembro\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(14, \"button\", 9);\n            i0.ɵɵtext(15);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelement(16, \"hr\", 10);\n            i0.ɵɵelementStart(17, \"div\", 11)(18, \"h2\");\n            i0.ɵɵtext(19, \"Grupos Registrados\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"div\", 12);\n            i0.ɵɵtemplate(21, GroupFormComponent_div_21_Template, 11, 2, \"div\", 13);\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate(ctx.isEditing ? \"Editar Grupo\" : \"Crear Nuevo Grupo\");\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"formGroup\", ctx.form);\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngForOf\", ctx.members.controls);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"disabled\", ctx.form.invalid);\n            i0.ɵɵadvance(1);\n            i0.ɵɵtextInterpolate1(\" \", ctx.isEditing ? \"Actualizar\" : \"Guardar en BD\", \" \");\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngForOf\", ctx.groupsList);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i1.FormGroupName, i1.FormArrayName],\n        encapsulation: 2\n      });\n    }\n  }\n  return GroupFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}